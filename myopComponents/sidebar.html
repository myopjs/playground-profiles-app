<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Dashboard Sidebar</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: transparent;
            font-family: Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            -webkit-font-smoothing: antialiased;
        }

        #app-root {
            opacity: 1;
            height: 100%;
        }

        .sidebar-container {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            background: #363740;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            display: flex;
            padding: 24px;
            flex-direction: column;
            align-items: flex-start;
            flex-shrink: 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.10);
        }

        .app-logo-wrapper {
            display: flex;
            align-items: flex-start;
            flex-direction: column;
            gap: 10px;
        }

        .app-logo {
            display: none;
        }

        .app-info {
            flex: 1;
        }

        .app-title {
            color: #FFF;
            font-size: 16px;
            font-weight: 400;
            line-height: 24px;
            letter-spacing: -0.312px;
            margin-bottom: 0;
        }

        .app-subtitle {
            color: rgba(255, 255, 255, 0.88);
            font-size: 12px;
            font-weight: 400;
            line-height: 16px;
        }

        .nav-section {
            flex: 1;
            padding: 32px 0;
            overflow-y: auto;
            overflow-x: hidden;
            min-height: 0;
        }

        .nav-item {
            display: flex;
            height: 44px;
            padding: 0 16px;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
            align-self: stretch;
            margin: 0 16px 4px 16px;
            border-radius: 10px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 16px;
            font-weight: 400;
            line-height: 24px;
            letter-spacing: -0.312px;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            position: relative;
        }

        .nav-item:hover:not(.active) {
            background: rgba(80, 255, 238, 0.1);
            color: #50FFEE;
        }

        .nav-item.active {
            background: #50FFEE;
            color: #363740;
            font-weight: 400;
        }

        .nav-item.active .nav-icon {
            stroke: #363740;
        }

        .nav-icon {
            width: 24px;
            height: 24px;
            flex-shrink: 0;
            stroke-width: 2;
        }

        .nav-text {
            flex: 1;
        }

        .sidebar-footer {
            padding: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.10);
            flex-shrink: 0;
            margin-top: auto;
        }

        .user-profile {
            display: flex;
            align-items: center;
            background: transparent;
            border-radius: 12px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            gap: 12px;
        }

        .user-profile:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .user-profile:hover .user-avatar {
            background: #50FFEE;
        }

        .user-avatar-wrapper {
            position: relative;
            flex-shrink: 0;
        }

        .user-avatar-wrapper::after {
            content: '';
            position: absolute;
            bottom: -2px;
            right: -2px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 2px solid #363740;
            background: #00C950;
            z-index: 1;
        }

        .user-avatar {
            display: flex;
            height: 32px;
            width: 32px;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            background: #50FFEE;
            font-size: 14px;
            font-weight: 600;
            color: #363740;
            flex-shrink: 0;
            transition: background 0.2s ease;
            overflow: hidden;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .user-name {
            color: #FFF;
            font-size: 16px;
            font-weight: 400;
            line-height: 24px;
            letter-spacing: -0.312px;
        }

        .user-role {
            display: block;
            color: rgba(255, 255, 255, 0.50);
            font-size: 12px;
            font-weight: 400;
            line-height: 16px;
        }

        .nav-section::-webkit-scrollbar {
            width: 6px;
        }

        .nav-section::-webkit-scrollbar-track {
            background: transparent;
        }

        .nav-section::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }

        .nav-section::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Mobile Toggle Button */
        .sidebar-toggle {
            display: none;
            width: 24px;
            height: 24px;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
            border-radius: 4px;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .sidebar-toggle svg {
            width: 14px;
            height: 14px;
            color: rgba(255, 255, 255, 0.6);
            transition: transform 0.3s ease;
        }

        .sidebar-toggle:hover svg {
            color: #50FFEE;
        }

        /* Arrow rotates when expanded */
        .sidebar-container.expanded .sidebar-toggle svg {
            transform: rotate(180deg);
        }

        /* Mobile view class - controlled by host app via isMobileView prop */
        /* NOTE: We don't use @media queries here because the iframe width doesn't reflect viewport width */
        body.mobile-view .sidebar-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        body.mobile-view .sidebar-container {
            width: 48px;
            transition: width 0.3s ease;
            z-index: 999;
        }

        body.mobile-view .sidebar-container.expanded {
            width: 33.33%;
            min-width: 110px;
        }

        body.mobile-view .sidebar-header {
            padding: 0 6px;
            flex-direction: row;
            align-items: center;
            gap: 6px;
            height: 48px;
            min-height: 48px;
        }

        body.mobile-view .app-logo-wrapper {
            flex-direction: row;
            align-items: center;
            gap: 6px;
            flex: 1;
            overflow: hidden;
        }

        body.mobile-view .app-info {
            opacity: 0;
            width: 0;
            overflow: hidden;
            transition: opacity 0.2s ease, width 0.3s ease;
            white-space: nowrap;
        }

        body.mobile-view .sidebar-container.expanded .app-info {
            opacity: 1;
            width: auto;
        }

        body.mobile-view .app-title {
            font-size: 11px;
            line-height: 14px;
        }

        body.mobile-view .app-subtitle {
            font-size: 9px;
            line-height: 11px;
        }

        body.mobile-view .nav-section {
            padding: 8px 0;
        }

        body.mobile-view .nav-item {
            margin: 0 4px 2px 4px;
            padding: 0 6px;
            height: 32px;
            justify-content: center;
            border-radius: 6px;
            gap: 6px;
        }

        body.mobile-view .sidebar-container.expanded .nav-item {
            justify-content: flex-start;
        }

        body.mobile-view .nav-icon {
            width: 18px;
            height: 18px;
        }

        body.mobile-view .nav-text {
            display: none;
            opacity: 0;
            transition: opacity 0.2s ease;
            font-size: 11px;
            line-height: 14px;
        }

        body.mobile-view .sidebar-container.expanded .nav-text {
            display: block;
            opacity: 1;
        }

        body.mobile-view .sidebar-footer {
            padding: 0 4px;
            height: 48px;
            min-height: 48px;
            display: flex;
            align-items: center;
        }

        body.mobile-view .user-profile {
            padding: 4px;
            justify-content: center;
            width: 100%;
            gap: 6px;
        }

        body.mobile-view .sidebar-container.expanded .user-profile {
            justify-content: flex-start;
        }

        body.mobile-view .user-avatar {
            width: 26px;
            height: 26px;
            font-size: 10px;
        }

        body.mobile-view .user-avatar-wrapper::after {
            width: 7px;
            height: 7px;
        }

        body.mobile-view .user-info {
            display: none;
            opacity: 0;
            transition: opacity 0.2s ease;
            gap: 1px;
        }

        body.mobile-view .sidebar-container.expanded .user-info {
            display: flex;
            opacity: 1;
        }

        body.mobile-view .user-name {
            font-size: 10px;
            line-height: 12px;
        }

        body.mobile-view .user-role {
            font-size: 8px;
            line-height: 10px;
        }
    </style>
</head>

<body>
<div id="app-root">
    <div class="sidebar-container" id="sidebarContainer">
        <div class="sidebar-header">
            <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
            </button>
            <div class="app-logo-wrapper">
                <div class="app-logo" id="appLogo">MT</div>
                <div class="app-info">
                    <div class="app-title" id="appTitle">My Team</div>
                    <div class="app-subtitle" id="appSubtitle">Profile Manager</div>
                </div>
            </div>
        </div>
        <div class="nav-section" id="navSection"></div>
        <div class="sidebar-footer">
            <div class="user-profile" id="userProfile">
                <div class="user-avatar-wrapper">
                    <div class="user-avatar" id="userAvatar">MC</div>
                </div>
                <div class="user-info">
                    <div class="user-name" id="userName">Maya</div>
                    <div class="user-role" id="userRole">Settings</div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    (function() {
        'use strict';
        var state = {
            appLogo: 'MT',
            appTitle: 'My Team',
            appSubtitle: 'Profile Manager',
            navItems: [
                { id: 'home', icon: 'home', text: 'Home' },
                { id: 'analytics', icon: 'analytics', text: 'Analytics' }
            ],
            activeNavItem: 'home',
            userData: { name: 'Maya', role: 'Settings', initials: 'MC', profileImage: null }
        };
        var elements = {};

        function cacheElements() {
            elements.appRoot = document.getElementById('app-root');
            elements.sidebarContainer = document.getElementById('sidebarContainer');
            elements.sidebarToggle = document.getElementById('sidebarToggle');
            elements.appLogo = document.getElementById('appLogo');
            elements.appTitle = document.getElementById('appTitle');
            elements.appSubtitle = document.getElementById('appSubtitle');
            elements.navSection = document.getElementById('navSection');
            elements.userProfile = document.getElementById('userProfile');
            elements.userAvatar = document.getElementById('userAvatar');
            elements.userName = document.getElementById('userName');
            elements.userRole = document.getElementById('userRole');
        }

        function applyMobileView(isMobileView) {
            if (isMobileView) {
                document.body.classList.add('mobile-view');
            } else {
                document.body.classList.remove('mobile-view');
            }
        }

        function toggleSidebar() {
            if (elements.sidebarContainer) {
                elements.sidebarContainer.classList.toggle('expanded');
                var isExpanded = elements.sidebarContainer.classList.contains('expanded');
                if (typeof window.myop_cta_handler === 'function') {
                    window.myop_cta_handler('sidebar_toggled', { expanded: isExpanded });
                }
            }
        }

        function closeSidebar() {
            if (elements.sidebarContainer) {
                var wasExpanded = elements.sidebarContainer.classList.contains('expanded');
                elements.sidebarContainer.classList.remove('expanded');
                if (wasExpanded && typeof window.myop_cta_handler === 'function') {
                    window.myop_cta_handler('sidebar_toggled', { expanded: false });
                }
            }
        }

        function getIconSVG(iconType) {
            var icons = {
                home: '<svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>',
                analytics: '<svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>',
                chart: '<svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>',
                users: '<svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>',
                settings: '<svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>',
                team: '<svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>',
                calendar: '<svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>',
                folder: '<svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>'
            };
            return icons[iconType] || icons.home;
        }

        function renderNavigation() {
            if (!elements.navSection) return;
            elements.navSection.innerHTML = state.navItems.map(function(item) {
                var isActive = item.id === state.activeNavItem;
                return '<div class="nav-item ' + (isActive ? 'active' : '') + '" data-nav-id="' + item.id + '">' + getIconSVG(item.icon) + '<span class="nav-text">' + item.text + '</span></div>';
            }).join('');
            elements.navSection.querySelectorAll('.nav-item').forEach(function(el) {
                el.addEventListener('click', function() { handleNavClick(this.dataset.navId); });
            });
        }

        function updateActiveNavItem() {
            var items = document.querySelectorAll('.nav-item');
            items.forEach(function(item) {
                if (item.dataset.navId === state.activeNavItem) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        }

        function updateHeader() {
            if (elements.appLogo) elements.appLogo.textContent = state.appLogo;
            if (elements.appTitle) elements.appTitle.textContent = state.appTitle;
            if (elements.appSubtitle) elements.appSubtitle.textContent = state.appSubtitle;
        }

        function updateUserProfile() {
            if (elements.userAvatar) {
                if (state.userData.profileImage) {
                    elements.userAvatar.innerHTML = '<img src="' + state.userData.profileImage + '" alt="' + state.userData.name + '">';
                } else {
                    elements.userAvatar.textContent = state.userData.initials || state.userData.name.charAt(0).toUpperCase();
                }
            }
            if (elements.userName) elements.userName.textContent = state.userData.name;
            if (elements.userRole) elements.userRole.textContent = state.userData.role;
        }

        function handleNavClick(navId) {
            state.activeNavItem = navId;
            updateActiveNavItem();
            // Close sidebar on mobile after navigation
            if (window.innerWidth <= 768) {
                closeSidebar();
            }
            if (typeof window.myop_cta_handler === 'function') {
                window.myop_cta_handler('nav_clicked', { navId: navId, navItem: state.navItems.find(function(i) { return i.id === navId; }) });
            }
        }

        function handleProfileClick() {
            // Close sidebar on mobile after clicking profile
            if (window.innerWidth <= 768) {
                closeSidebar();
            }
            if (typeof window.myop_cta_handler === 'function') {
                window.myop_cta_handler('profile_clicked', { userData: Object.assign({}, state.userData) });
            }
        }

        function attachEventListeners() {
            if (elements.userProfile) elements.userProfile.addEventListener('click', handleProfileClick);
            if (elements.sidebarToggle) elements.sidebarToggle.addEventListener('click', toggleSidebar);
        }

        function render() {
            updateHeader();
            renderNavigation();
            updateUserProfile();
        }

        function initializeComponent(data) {
            if (data) {
                if (data.isMobileView !== undefined) {
                    applyMobileView(data.isMobileView);
                }
                if (data.appLogo !== undefined) state.appLogo = data.appLogo;
                if (data.appTitle !== undefined) state.appTitle = data.appTitle;
                if (data.appSubtitle !== undefined) state.appSubtitle = data.appSubtitle;
                if (data.navItems) state.navItems = data.navItems;
                if (data.activeNavItem !== undefined) state.activeNavItem = data.activeNavItem;
                if (data.userData) state.userData = Object.assign({}, state.userData, data.userData);
            }
            render();
        }

        window.myop_init_interface = function(data) {
            if (arguments.length === 0) {
                return {
                    appLogo: state.appLogo,
                    appTitle: state.appTitle,
                    appSubtitle: state.appSubtitle,
                    navItems: state.navItems.slice(),
                    activeNavItem: state.activeNavItem,
                    userData: Object.assign({}, state.userData)
                };
            }
            if (data && data.action) {
                switch (data.action) {
                    case 'setActiveNav':
                        if (data.payload) { state.activeNavItem = data.payload; updateActiveNavItem(); }
                        break;
                    case 'setNavItems':
                        if (data.payload) { state.navItems = data.payload; renderNavigation(); }
                        break;
                    case 'setUserData':
                        if (data.payload) { state.userData = Object.assign({}, state.userData, data.payload); updateUserProfile(); }
                        break;
                    case 'setHeader':
                        if (data.payload) {
                            if (data.payload.appLogo !== undefined) state.appLogo = data.payload.appLogo;
                            if (data.payload.appTitle !== undefined) state.appTitle = data.payload.appTitle;
                            if (data.payload.appSubtitle !== undefined) state.appSubtitle = data.payload.appSubtitle;
                            updateHeader();
                        }
                        break;
                    default: console.warn('Sidebar: Unknown action:', data.action);
                }
                return;
            }
            initializeComponent(data);
        };

        window.myop_cta_handler = function(actionId, payload) { console.log('CTA Handler called:', actionId, payload); };

        function init() {
            cacheElements();
            attachEventListeners();
            render();
            console.log('Sidebar component ready');
        }
        if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', init); } else { init(); }
    })();
</script>
</body>

</html>